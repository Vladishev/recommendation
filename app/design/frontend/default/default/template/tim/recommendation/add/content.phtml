<?php
$product = Mage::registry('current_product');
$isLoggedIn = Mage::getSingleton('customer/session')->isLoggedIn();
$customerId = Mage::getSingleton('customer/session')->getCustomer()->getId();
$profileStatus = $this->getProfileStatus($customerId);
$customerIp = Mage::helper('core/http')->getRemoteAddr();
$customerHostName = $this->getHost($customerIp);
$requiredFields = $this->getRequiredFields();
$opinionLimitCharacters = Mage::helper('tim_recommendation')->getMaxMinCharacters('opinion');
$opinionTextareaPlaceholder = $this->getOpinionPlaceholder($opinionLimitCharacters);
$opinionTextareaValidationClass = $this->getOpinionTextareaValidationClass($opinionLimitCharacters);
?>
<form action="<?php echo $this->getUrl('recommendation/index/add') ?>" method="post" id="form-validate-opinion"
      autocomplete="off" enctype="multipart/form-data">
    <input type="hidden" id="tim-profile-status" value="<?php echo $profileStatus; ?>"/>
    <input type="hidden" id="isLoggedIn" value="<?php echo $isLoggedIn ?>"/>
    <fieldset>
        <p class="required"><?php echo $this->__('* Required Fields') ?></p>
        <div class="tim-opinion">
            <label for="tim-opinion-advantages" class="tim-opinion-content-subtitle tim-icon-good <?php echo $requiredFields['advantages']? 'required' : '' ?>">
                <?php echo $requiredFields['advantages']? '<em>*</em>' : '' ?>
                <?php echo $this->__('Describe the advantages of the product:') ?>
            </label>
            <div class="tim-opinion-content tim-add-opinion">
                <textarea name="opinion-advantages" id="tim-opinion-advantages" cols="5" rows="3"
                          class="check-tim-profile-status tim-opinion-characters-count <?php echo $opinionTextareaValidationClass ?> <?php echo $requiredFields['advantages']? 'required-entry' : '' ?>"
                          onclick="<?php echo !$isLoggedIn ? 'checkIfUserIsLoggedIn();' : ''?> placeholderAction(this)"
                    <?php echo !$isLoggedIn || !$profileStatus ? 'readonly="yes"' : ''?>></textarea>
                <div id="ph-tim-opinion-advantages" class="placeholder-div">
                    <?php echo $opinionTextareaPlaceholder; ?>
                </div>
            </div>
            <div class="char-count" id="char-count-tim-opinion-advantages"><span>0</span></div>
            <label for="tim-opinion-disadvantages" class="tim-opinion-content-subtitle tim-icon-bad <?php echo $requiredFields['defects']? 'required' : '' ?>">
                <?php echo $requiredFields['defects']? '<em>*</em>' : '' ?>
                <?php echo $this->__('Describe product defects:') ?>
            </label>
            <div class="tim-opinion-content tim-add-opinion">
                <textarea name="opinion-disadvantages" id="tim-opinion-disadvantages" cols="5" rows="3"
                          class="check-tim-profile-status tim-opinion-characters-count <?php echo $opinionTextareaValidationClass ?> <?php echo $requiredFields['defects']? 'required-entry' : '' ?>"
                          onclick="<?php echo !$isLoggedIn ? 'checkIfUserIsLoggedIn();' : ''?> placeholderAction(this)"
                    <?php echo !$isLoggedIn || !$profileStatus ? 'readonly="yes"' : ''?>></textarea>
                <div id="ph-tim-opinion-disadvantages" class="placeholder-div" >
                    <?php echo $opinionTextareaPlaceholder; ?>
                </div>
            </div>
            <div class="char-count" id="char-count-tim-opinion-disadvantages"><span>0</span></div>

            <label for="tim-opinion-summary" class="tim-opinion-content-subtitle tim-icon-summary <?php echo $requiredFields['summary']? 'required' : '' ?>">
                <?php echo $requiredFields['summary']? '<em>*</em>' : '' ?>
                <?php echo $this->__('Summary / additional information / comments:') ?>
            </label>
            <div class="tim-opinion-content tim-add-opinion">
                <textarea name="opinion-summary" id="tim-opinion-summary" cols="5" rows="3"
                          class="check-tim-profile-status tim-opinion-characters-count <?php echo $opinionTextareaValidationClass ?> <?php echo $requiredFields['summary']? 'required-entry' : '' ?>"
                          onclick="<?php echo !$isLoggedIn ? 'checkIfUserIsLoggedIn();' : ''?> placeholderAction(this)"
                    <?php echo !$isLoggedIn || !$profileStatus ? 'readonly="yes"' : ''?>></textarea>
                <div id="ph-tim-opinion-summary" class="placeholder-div" >
                    <?php echo $opinionTextareaPlaceholder; ?>
                </div>
            </div>
            <div class="char-count" id="char-count-tim-opinion-summary"><span>0</span></div>

            <div class="tim-rating-input-container">
                <div class="tim-secondary-title"><?php echo $this->__('RATE QUALITY OF PRODUCT') ?></div>
                <?php $options = array(5, 4, 3, 2, 1); ?>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Price to quality:') ?>
                        <?php if($requiredFields['price_to_quality']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <span class="tim-rating-choice">
                        <?php if(!$requiredFields['price_to_quality']) : ?>
                            <input type="hidden" name="itemValuetomoney" value="0"/>
                        <?php endif; ?>
                        <?php foreach ($options as $option): ?>
                        <input type="radio" name="itemValuetomoney"
                        class="radio tim-rating-input-span check-tim-profile-status <?php echo end($options) == $option ? 'validate-one-required':'' ?>"
                        id="radio-itemValuetomoney-1-<?php echo $option ?>" value="<?php echo $option ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                        <label for="radio-itemValuetomoney-1-<?php echo $option ?>" class="tim-rating-star"></label>
                        <?php endforeach; ?>
                    </span>
                    <span><span class="itemValuetomoney">0</span>/5</span>
                </div>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Production quality') ?>:
                        <?php if($requiredFields['product_durability']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <span class="tim-rating-choice">
                        <?php if(!$requiredFields['product_durability']) : ?>
                            <input type="hidden" name="itemDurability" value="0"/>
                        <?php endif; ?>
                        <?php foreach ($options as $option): ?>
                        <input type="radio" name="itemDurability"
                        class="radio tim-rating-input-span check-tim-profile-status <?php echo end($options) == $option ? 'validate-one-required':'' ?>"
                        id="radio-itemDurability-1-<?php echo $option ?>" value="<?php echo $option ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                        <label for="radio-itemDurability-1-<?php echo $option ?>" class="tim-rating-star"></label>
                        <?php endforeach; ?>
                    </span>
                    <span><span class="itemDurability">0</span>/5</span>
                </div>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Durability and reliability') ?>:
                        <?php if($requiredFields['product_failure']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <span class="tim-rating-choice">
                        <?php if(!$requiredFields['product_failure']) : ?>
                            <input type="hidden" name="itemFailure" value="0"/>
                        <?php endif; ?>
                        <?php foreach ($options as $option): ?>
                        <input type="radio" name="itemFailure"
                        class="radio tim-rating-input-span check-tim-profile-status <?php echo end($options) == $option ? 'validate-one-required':'' ?>"
                        id="radio-itemFailure-1-<?php echo $option ?>" value="<?php echo $option ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                        <label for="radio-itemFailure-1-<?php echo $option ?>" class="tim-rating-star"></label>
                        <?php endforeach; ?>
                    </span>
                    <span><span class="itemFailure">0</span>/5</span>
                </div>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Easy to install') ?>:
                        <?php if($requiredFields['easy_installation']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <span class="tim-rating-choice">
                        <?php if(!$requiredFields['easy_installation']) : ?>
                            <input type="hidden" name="itemEaseofinstall" value="0"/>
                        <?php endif; ?>
                        <?php foreach ($options as $option): ?>
                        <input type="radio" name="itemEaseofinstall"
                        class="radio tim-rating-input-span check-tim-profile-status <?php echo end($options) == $option ? 'validate-one-required':'' ?>"
                        id="radio-itemEaseofinstall-1-<?php echo $option ?>" value="<?php echo $option ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                        <label for="radio-itemEaseofinstall-1-<?php echo $option ?>" class="tim-rating-star"></label>
                        <?php endforeach; ?>
                    </span>
                    <span><span class="itemEaseofinstall">0</span>/5</span>
                </div>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Do you use this product') ?>:
                        <?php if($requiredFields['use_product']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <?php if(!$requiredFields['use_product']) : ?>
                        <input type="hidden" name="itemDoyouuseitem" value="null"/>
                    <?php endif; ?>
                    <input type="radio" name="itemDoyouuseitem" id="radio-itemDoyouuseitem1" value="1" class="radio tim-rating-button-boolean check-tim-profile-status"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                    <label for="radio-itemDoyouuseitem1" class="tim-rating-button-boolean-label"><?php echo $this->__('Yes') ?></label>
                    <input type="radio" name="itemDoyouuseitem" id="radio-itemDoyouuseitem2" value="0"
                           class="radio tim-rating-button-boolean check-tim-profile-status <?php echo $requiredFields['use_product'] ? 'validate-one-required':'' ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                    <label for="radio-itemDoyouuseitem2" class="tim-rating-button-boolean-label"><?php echo $this->__('No') ?></label>
                </div>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Do you recommend this product') ?>:
                        <?php if($requiredFields['recommend_product']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <?php if(!$requiredFields['recommend_product']) : ?>
                        <input type="hidden" name="itemDoyourecommend" value="null"/>
                    <?php endif; ?>
                    <input type="radio" name="itemDoyourecommend" id="radio-itemDoyourecommend1" value="1" class="radio tim-rating-button-boolean check-tim-profile-status"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                    <label for="radio-itemDoyourecommend1" class="tim-rating-button-boolean-label"><?php echo $this->__('Yes') ?></label>
                    <input type="radio" name="itemDoyourecommend" id="radio-itemDoyourecommend2" value="0"
                           class="radio tim-rating-button-boolean check-tim-profile-status <?php echo $requiredFields['recommend_product'] ? 'validate-one-required':'' ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn()"' : ''?>/>
                    <label for="radio-itemDoyourecommend2" class="tim-rating-button-boolean-label"><?php echo $this->__('No') ?></label>
                </div>
                <div class="tim-rating-input">
                    <p>
                        <?php echo $this->__('Here you can add photos') ?>:
                        <?php if($requiredFields['add_photo']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <input type="file" name="tim-recommendation-img[]" id="recommendation-img" accept="image/jpeg, image/png" max-size="5242880" multiple="multiple"
                           class="tim-comm-button-smal check-tim-profile-status <?php echo $requiredFields['add_photo']? 'required-entry' : '' ?>"
                        <?php echo !$isLoggedIn ? 'onclick="checkIfUserIsLoggedIn(); return false;"' : ''?>
                        onchange="addFilesToOpinion()"/>
                    <label for="recommendation-img" class="tim-comm-button-smal"><?php echo $this->__('Load photos') ?></label>
                    <div id="downloaded-imgs"></div>
                    <input type="hidden" name="deleted_imgs" id="deleted-imgs"/>
                    <input type="hidden" name="imagesForSave" id="imagesForSave"/>
                </div>
                <div class="tim-rating-input-url">
                    <p>
                        <?php echo $this->__('Here you can add video') ?>:
                        <?php if($requiredFields['add_video']) : ?>
                            <label class="required"><em>*</em></label>
                        <?php endif; ?>
                    </p>
                    <input name="link_to_youtube" id="link_to_youtube"
                           class="validate-url-link check-tim-profile-status input-text <?php echo $requiredFields['add_video']? 'required-entry' : '' ?>"
                           placeholder="<?php echo $this->__('Add link from Youtube') ?>" style="color:#949090;"
                        <?php echo !$isLoggedIn ? 'onfocus="checkIfUserIsLoggedIn()" onclick="checkIfUserIsLoggedIn()"' : ''?>
                        <?php echo !$isLoggedIn || !$profileStatus ? 'readonly="yes"' : ''?>/>
                    <!-- place for user input - add movie - url to youtube -->
                </div>
            </div>
        </div>
        <input type="hidden" name="customer_id" value="<?php echo $customerId ?>"/>
        <input type="hidden" name="product_id" value="<?php echo $product->getId(); ?>"/>
        <input type="hidden" name="customer_ip_address" value="<?php echo $customerIp ?>"/>
        <input type="hidden" name="customer_host_name" value="<?php echo $customerHostName ?>"/>
        <input type="hidden" name="manufacturer_id" value="<?php echo $product->getManufacturer() ?>"/>
        <input type="hidden" name="current_category_id" value="<?php echo $product->getCategoryId() ?>"/>
        <input type="hidden" name="add_method" value="<?php echo $customerId ? 'Użytkownik' : null ?>"/>
        <input type="hidden" name="saveTmpImgUrl" value="<?php echo $this->getUrl('recommendation/index/saveOpinionImgTmp') ?>"/>

        <div class="tim-comment-add">
            <?php if ($isLoggedIn): ?>
                <input type="submit" title="<?php echo $this->__('Add opinion') ?>" class="tim-comm-button-addopinion check-tim-profile-status" id="add-ajax-opinion"
                value="<?php echo $this->__('Add opinion') ?>"/>
            <?php else: ?>
                <button type="button" title="<?php echo $this->__('Add opinion') ?>" class="tim-comm-button-addopinion" onclick="checkIfUserIsLoggedIn()">
                    <span><span><?php echo $this->__('Add opinion') ?></span></span>
                </button>
            <?php endif; ?>
        </div>
        <button type="button" title="<?php echo $this->__('Close form') ?>" class="tim-comm-button-addopinion tim-comment-close-form" onclick="hideAddOpinionForm()">
            <span><span><?php echo $this->__('Close form') ?></span></span>
        </button>
    </fieldset>
</form>
<div id="loading-frontend-mask-opinion">
    <p class="loader" id="loading_mask_loader">
        <img src="<?php echo $this->getSkinUrl('images/opc-ajax-loader.gif',array('_secure'=>true))?>"
             alt="<?php echo Mage::helper('adminhtml')->__('Loading...') ?>" /><br />
        <?php echo Mage::helper('adminhtml')->__('Please wait...') ?></p>
</div>
<input type="hidden" id="opinionLimitChars"
       data-min="<?php echo $opinionLimitCharacters['min'] ?>"
       data-max="<?php echo $opinionLimitCharacters['max'] ?>"/>
<script type="text/javascript">
    //<![CDATA[
    var dataForm = new VarienForm('form-validate-opinion', true);
    //]]>
</script>