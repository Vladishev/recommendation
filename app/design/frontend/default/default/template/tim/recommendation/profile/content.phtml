<?php
$userId = $this->getRequest()->getParam('id');
$userData = $this->getUserData($userId);
$userOpinionData = $this->getUserOpinionData($userId);
$opinionComments = $this->getOpinionComment($userId);
$opinionCount = $this->getUserOpinionCount($userId);
$limitPerPage = 10;
$pagesCount = ceil($opinionCount / $limitPerPage);
$site = $userData['www'];
if(!empty($site)){
    if (!strstr($site, 'http://') && !strstr($site, 'https://')) {
        $site = 'http://' . $site;
    }
} else {
    $site = null;
}
?>
<div class="tim-comm-left-column tim-comm-left-column-landing tim-comm-border-right">
    <div class="tim-user"> <!-- main container for user details -->
        <div class="tim-user-photo">
            <img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB) . $userData['avatar'] ?>" width="269" height="168"
                 alt="user-photo"/>
            <!-- place for user photo -->
        </div>
        <div class="tim-user-name">
            <p><?php echo $this->__('User'); ?></p>
            <!-- place for user name -->
            <p><?php echo $userData['customer_nick']; ?></p>
        </div>
        <div class="tim-user-type">
            <div class="tim-user-type-icon">
                <img src="<?php echo $this->getSkinUrl('images/media/userstatus_icon_timworker.png'); ?>" alt="user-status"/>
            </div>
            <?php echo $this->__('User type'); ?>
            <!-- place for user name and icon -->
            <p><?php echo $userData['user_type_name']; ?></p>
        </div>
        <div class="tim-user-involvement">
            <?php echo $this->__('User involvement'); ?>
            <!-- place for user score which will result from the number of entries -->
            <div class="tim-user-scoregraph tim-score-2">
                <!-- number of opinons -->
                <?php echo $this->__('%s opinii', $userData['opinion_qty']); ?>
            </div>
            <!-- place for graphic presentation of score for example +1 element will be highlighted for every 100 posts -->
        </div>
        <div class="tim-user-email">
            <!-- place for user e-mail if he want to show that  -->
            <?php echo $userData['email']; ?>
        </div>
    </div>
</div>

<div class="tim-comm-main-column-wide tim-col-noborder">
    <div class="tim-opinion">
        <div class="tim-opinion-content-subtitle tim-triangle-background"><?php echo $this->__("ABOUT USER"); ?></div>
        <div class="tim-user-about-textfield">
            <!-- about user info based on his own input --><!-- tem -->
            <?php echo $userData['description']; ?>
        </div>
        <?php if(!empty($userData['ad'])): ?>
        <div class="tim-user-picture">
            <!-- graphic provided by user -->
            <img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB) . $userData['ad']; ?>" alt="user-picture"/>
        </div>
        <?php endif ?>
        <?php if(!empty($site)): ?>
        <div class="tim-user-wwwpage">
            <div class="tim-user-wwwpage-button">
                <?php echo $this->__("Website User"); ?>: <!-- link to user webpage -->
                <a href="<?php echo $site; ?>" target="_blank"><?php echo $site; ?></a>
            </div>
        </div>
        <?php endif ?>
    </div>
    <!-- start of user's opinion list -->
    <div class="tim-opinion-list">
        <div class="tim-opinion-content-subtitle tim-triangle-background"><?php echo $this->__("OPINIE DODANE PRZEZ UŻYTKOWNIKA"); ?></div>
        <div class="tim-opinion-list-header">
            <input
                type="hidden"
                id="tim-controller"
                data-url="<?php echo $this->getUrl('recommendation/timToolbar/sortUserPage') ?>"
                data-product="0"
                data-userid="<?php echo $userId; ?>"
                data-page="userPage"/>
            <div class="tim-opinion-list-header-pagecount">
                <input class="tim-pager-box" value="1" type="text">
                <p><?php echo $this->__('z ') ?></p><!-- go to page X from all -->
                <span class="tim-pager-total"><?php echo $pagesCount ?></span>
                <?php if ($pagesCount > 1):  ?>
                <button class="tim-pager-decrease-button" onclick="changeCountAndPager(this)">< </button>
                <button class="tim-pager-increase-button" onclick="changeCountAndPager(this)"> ></button>
                <?php endif ?>
            </div>
            <div class="tim-opinion-list-header-howmuchshow"> <!-- how many opinion show on one page -->
                <p><?php echo $this->__('Wyświetl:') ?></p>
                <ul>
                    <li>
                        <span class="tim-toolbar-count count-active" onclick="changeCountAndPager(this)">10</span>
                    </li>
                    <li>
                        <span class="tim-toolbar-count" onclick="changeCountAndPager(this)">20</span>
                    </li>
                    <li>
                        <span class="tim-toolbar-count" onclick="changeCountAndPager(this)">30</span>
                    </li>
                </ul>
                <p><?php echo $this->__('opinii:') ?></p>
            </div>
            <div class="tim-comm-sorting">
                <p><?php echo $this->__("Criterion sorting"); ?></p>
                <select class="tim-comm-sortingselect tim-toolbar-select">
                    <!-- sort existed opinions based on things like date added, higest/lowest score etc. -->
                    <option value="latest" selected="selected"><?php echo $this->__("Latest"); ?></option>
                    <option value="oldest"><?php echo $this->__("Oldest"); ?></option>
                    <option value="topRated"><?php echo $this->__("Top rated"); ?></option>
                    <option value="lowRated"><?php echo $this->__("The lowest assessment"); ?></option>
                </select>
            </div>
        </div>
        <div class="tim-comm-list-bulk tim-profile-opinion-list">
            <!-- listing of newest opinions -->
            <div class="tim-comm-list-titlebar">
                <div class="tim-list-col1"><?php echo $this->__('Produkt') ?></div>
                <div class="tim-list-col2"><?php echo $this->__('Średnia Ocena') ?></div>
            </div>
            <!-- for each company -->
            <div id="tim-list-container">
            <?php $i = 0; ?>
            <?php foreach ($userOpinionData as $itemData): ?>
                <?php if ($i > ($limitPerPage - 1)) break; ?>
                <div class="tim-comm-list-bulk-positions tim-products-opinion-list-<?php echo $i ?>">
                    <div class="tim-comm-list-bulk-name tim-list-col1"> <!-- company name -->
                        <a class="tim-a-tag" href="<?php echo $itemData['url']; ?>"><img src="<?php echo $itemData['image']; ?>" alt="Zdjęcie produktu"/><?php echo $this->__($itemData['name']) ?></a>
                    </div>
                    <div class="tim-comm-list-bulk-rating tim-list-col2"><!-- company rating -->
                        <div class="tim-comm-list-bulk-rating-bar">
                            <div class="tim-comm-list-bulk-rating-barinner">
                                <?php echo $this->__($itemData['rating']) ?>
                                <span><?php echo $this->__('/5') ?></span>
                            </div>
                        </div>
                    </div>
                </div>
                <?php $i++; ?>
            <?php endforeach; ?>
            </div>
            <!-- end for each -->
        </div>
    </div>
    <div class="tim-opinion-content-subtitle tim-triangle-background"><?php echo $this->__("KOMENTARZE DODANE PRZEZ UŻYTKOWNIKA"); ?></div>
<!--  Start comments toolbar  -->
    <div class="tim-opinion-list-header">
        <input
            type="hidden"
            id="comments-controller"
            data-url="<?php echo $this->getUrl('recommendation/timToolbar/sortUserComments') ?>"
            data-userid="<?php echo $userId; ?>"/>
        <div class="tim-opinion-list-header-pagecount">
            <input class="tim-pager-box" value="1" type="text">
            <p><?php echo $this->__('z ') ?></p><!-- go to page X from all -->
            <span class="tim-pager-total"><?php echo $pagesCount ?></span>
            <?php if ($pagesCount > 1):  ?>
                <button class="tim-pager-decrease-button" onclick="changeCountAndPager(this)">< </button>
                <button class="tim-pager-increase-button" onclick="changeCountAndPager(this)"> ></button>
            <?php endif ?>
        </div>
        <div class="tim-opinion-list-header-howmuchshow"> <!-- how many opinion show on one page -->
            <p><?php echo $this->__('Wyświetl:') ?></p>
            <ul>
                <li>
                    <span class="tim-toolbar-count count-active" onclick="changeCountAndPager(this)">10</span>
                </li>
                <li>
                    <span class="tim-toolbar-count" onclick="changeCountAndPager(this)">20</span>
                </li>
                <li>
                    <span class="tim-toolbar-count" onclick="changeCountAndPager(this)">30</span>
                </li>
            </ul>
            <p><?php echo $this->__('opinii:') ?></p>
        </div>
        <div class="tim-comm-sorting">
            <p><?php echo $this->__("Criterion sorting"); ?></p>
            <select class="tim-comm-sortingselect tim-toolbar-select">
                <!-- sort existed opinions based on things like date added, higest/lowest score etc. -->
                <option value="latest" selected="selected"><?php echo $this->__("Latest"); ?></option>
                <option value="oldest"><?php echo $this->__("Oldest"); ?></option>
                <option value="topRated"><?php echo $this->__("Top rated"); ?></option>
                <option value="lowRated"><?php echo $this->__("The lowest assessment"); ?></option>
            </select>
        </div>
    </div>
<!--  End comments toolbar  -->
    <!-- start of user's comments list -->
    <div class="tim-comment">
        <?php foreach ($opinionComments as $comment): ?>
            <!-- for each comment owned by user (start) -->
            <div class="tim-comment-container">
                <div class="tim-comment-container-title">
                    <?php echo $this->__("Comment added"); ?>
                    <span><?php echo $comment['date_add']; ?></span>
                    <?php echo $this->__(" for product reviews: "); ?>
                    <span class="tim-comm-list-bulk-name"><a href="<?php echo $comment['url'] ?>"><?php echo $comment['name'] ?></a></span>
                </div>
                <div class="tim-comment-container-content">
                    <!-- content of comment -->
                    <?php echo $this->__($comment['comment']); ?>
                </div>
            </div>
        <?php endforeach; ?>
        <!-- for each comment (end) -->
    </div>
</div>